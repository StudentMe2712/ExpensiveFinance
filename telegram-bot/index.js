const TelegramBot = require('node-telegram-bot-api');
const axios = require('axios');

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
const BOT_TOKEN = process.env.TELEGRAM_BOT_TOKEN || '8275935313:AAEJ6O8HN_6r6X-XRzzRpuWwb8jC883yn8o';
const WEBSITE_URL = process.env.WEBSITE_URL || 'https://expensive-finance.vercel.app';

// –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞
const bot = new TelegramBot(BOT_TOKEN, { polling: true });

// –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
const userStates = new Map();

// –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
const mainMenu = {
  reply_markup: {
    keyboard: [
      ['üí∞ –ö—Ä–µ–¥–∏—Ç—ã', 'üè¶ –î–µ–ø–æ–∑–∏—Ç—ã'],
      ['üìä –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä', 'üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã'],
      ['‚ÑπÔ∏è –û –∫–æ–º–ø–∞–Ω–∏–∏', 'üåê –ù–∞—à —Å–∞–π—Ç']
    ],
    resize_keyboard: true,
    one_time_keyboard: false
  }
};

// –ö—Ä–µ–¥–∏—Ç–Ω–æ–µ –º–µ–Ω—é
const creditMenu = {
  reply_markup: {
    keyboard: [
      ['üöÄ –≠–∫—Å–ø—Ä–µ—Å—Å –∫—Ä–µ–¥–∏—Ç', 'üè† –ò–ø–æ—Ç–µ–∫–∞'],
      ['üöó –ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç', 'üíº –ë–∏–∑–Ω–µ—Å –∫—Ä–µ–¥–∏—Ç'],
      ['üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é']
    ],
    resize_keyboard: true,
    one_time_keyboard: false
  }
};

// –î–µ–ø–æ–∑–∏—Ç–Ω–æ–µ –º–µ–Ω—é
const depositMenu = {
  reply_markup: {
    keyboard: [
      ['üìà –†–∞—Ö–º–µ—Ç –¥–µ–ø–æ–∑–∏—Ç', 'üíé –ü—Ä–µ–º–∏—É–º –¥–µ–ø–æ–∑–∏—Ç'],
      ['üìÖ –°—Ä–æ—á–Ω—ã–π –¥–µ–ø–æ–∑–∏—Ç', 'üîÑ –ü–æ–ø–æ–ª–Ω—è–µ–º—ã–π'],
      ['üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é']
    ],
    resize_keyboard: true,
    one_time_keyboard: false
  }
};

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start
bot.onText(/\/start/, (msg) => {
  const chatId = msg.chat.id;
  const firstName = msg.from.first_name;
  
  const welcomeMessage = `
üëã –ü—Ä–∏–≤–µ—Ç, ${firstName}!

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Expensive Finance! 
–Ø –ø–æ–º–æ–≥—É –≤–∞–º —Å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏.

–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π –≤–∞—Å —Ä–∞–∑–¥–µ–ª:
  `;
  
  bot.sendMessage(chatId, welcomeMessage, mainMenu);
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
bot.on('message', (msg) => {
  const chatId = msg.chat.id;
  const text = msg.text;
  const userId = msg.from.id;
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  if (!userStates.has(userId)) {
    userStates.set(userId, 'main');
  }
  
  const userState = userStates.get(userId);
  
  switch (text) {
    case 'üí∞ –ö—Ä–µ–¥–∏—Ç—ã':
      userStates.set(userId, 'credits');
      bot.sendMessage(chatId, 'üí≥ –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∫—Ä–µ–¥–∏—Ç–∞:', creditMenu);
      break;
      
    case 'üè¶ –î–µ–ø–æ–∑–∏—Ç—ã':
      userStates.set(userId, 'deposits');
      bot.sendMessage(chatId, 'üè¶ –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –¥–µ–ø–æ–∑–∏—Ç–∞:', depositMenu);
      break;
      
    case 'üìä –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä':
      bot.sendMessage(chatId, 
        `üßÆ –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∫—Ä–µ–¥–∏—Ç–∞ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –Ω–∞—à —Å–∞–π—Ç:\n\n${WEBSITE_URL}/#credit-calculator\n\n–¢–∞–º –≤—ã –Ω–∞–π–¥–µ—Ç–µ —É–¥–æ–±–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏ —Å–ª–∞–π–¥–µ—Ä–∞–º–∏!`,
        {
          reply_markup: {
            inline_keyboard: [[
              { text: 'üåê –û—Ç–∫—Ä—ã—Ç—å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä', url: `${WEBSITE_URL}/#credit-calculator` }
            ]]
          }
        }
      );
      break;
      
    case 'üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã':
      bot.sendMessage(chatId, 
        `üìû –ù–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã:\n\nüì± –¢–µ–ª–µ—Ñ–æ–Ω: +7 (777) 123-45-67\nüìß Email: info@expensive-finance.com\nüí¨ WhatsApp: +7 (777) 123-45-67\nüì± Telegram: @expensive_finance\n\nüïê –†–∞–±–æ—Ç–∞–µ–º: 9:00 - 21:00 (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ)`,
        {
          reply_markup: {
            inline_keyboard: [
              [{ text: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å', url: 'tel:+77771234567' }],
              [{ text: 'üí¨ WhatsApp', url: 'https://wa.me/77771234567' }],
              [{ text: 'üìß Email', url: 'mailto:info@expensive-finance.com' }]
            ]
          }
        }
      );
      break;
      
    case '‚ÑπÔ∏è –û –∫–æ–º–ø–∞–Ω–∏–∏':
      bot.sendMessage(chatId, 
        `üè¢ –û –∫–æ–º–ø–∞–Ω–∏–∏ Expensive Finance:\n\n‚úÖ –õ–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è\n‚úÖ –†–∞–±–æ—Ç–∞–µ–º —Å 2018 –≥–æ–¥–∞\n‚úÖ –ë–æ–ª–µ–µ 10,000 –¥–æ–≤–æ–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤\n‚úÖ –û–¥–æ–±—Ä–µ–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–∞ –∑–∞ 24 —á–∞—Å–∞\n‚úÖ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –∫–∞–∂–¥–æ–º—É –∫–ª–∏–µ–Ω—Ç—É\n\nüéØ –ù–∞—à–∞ –º–∏—Å—Å–∏—è - –ø–æ–º–æ—á—å –∫–∞–∂–¥–æ–º—É –ø–æ–ª—É—á–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —É—Å–ª—É–≥–∏!`,
        {
          reply_markup: {
            inline_keyboard: [[
              { text: 'üåê –ü–æ–¥—Ä–æ–±–Ω–µ–µ –Ω–∞ —Å–∞–π—Ç–µ', url: `${WEBSITE_URL}/about` }
            ]]
          }
        }
      );
      break;
      
    case 'üåê –ù–∞—à —Å–∞–π—Ç':
      bot.sendMessage(chatId, 
        `üåê –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –Ω–∞—à —Å–∞–π—Ç!\n\n–¢–∞–º –≤—ã –Ω–∞–π–¥–µ—Ç–µ:\n‚Ä¢ üìä –ö—Ä–µ–¥–∏—Ç–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä\n‚Ä¢ üìã –û–Ω–ª–∞–π–Ω –∑–∞—è–≤–∫–∏\n‚Ä¢ üìà –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å—Ç–∞–≤–∫–∏\n‚Ä¢ üìû –ö–æ–Ω—Ç–∞–∫—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é\n\n–ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∏ –∏–∑—É—á–∞–π—Ç–µ –Ω–∞—à–∏ —É—Å–ª—É–≥–∏!`,
        {
          reply_markup: {
            inline_keyboard: [[
              { text: 'üåê –û—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç', url: WEBSITE_URL }
            ]]
          }
        }
      );
      break;
      
    // –ö—Ä–µ–¥–∏—Ç–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã
    case 'üöÄ –≠–∫—Å–ø—Ä–µ—Å—Å –∫—Ä–µ–¥–∏—Ç':
      bot.sendMessage(chatId, 
        `üöÄ –≠–∫—Å–ø—Ä–µ—Å—Å –∫—Ä–µ–¥–∏—Ç:\n\nüí∞ –°—É–º–º–∞: –¥–æ 3,000,000 ‚Ç∏\n‚è∞ –°—Ä–æ–∫: –¥–æ 36 –º–µ—Å—è—Ü–µ–≤\nüìä –°—Ç–∞–≤–∫–∞: –æ—Ç 13,10% –≥–æ–¥–æ–≤—ã—Ö\n‚ö° –û–¥–æ–±—Ä–µ–Ω–∏–µ: –∑–∞ 24 —á–∞—Å–∞\n\n‚úÖ –ë–µ–∑ —Å–ø—Ä–∞–≤–æ–∫ –æ –¥–æ—Ö–æ–¥–∞—Ö\n‚úÖ –û–Ω–ª–∞–π–Ω –∑–∞—è–≤–∫–∞\n‚úÖ –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ\n\n–•–æ—Ç–∏—Ç–µ –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É?`,
        {
          reply_markup: {
            inline_keyboard: [
              [{ text: 'üìã –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É', url: `${WEBSITE_URL}/#application` }],
              [{ text: 'üßÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–ª–∞—Ç–µ–∂', url: `${WEBSITE_URL}/#credit-calculator` }]
            ]
          }
        }
      );
      break;
      
    case 'üè† –ò–ø–æ—Ç–µ–∫–∞':
      bot.sendMessage(chatId, 
        `üè† –ò–ø–æ—Ç–µ—á–Ω—ã–π –∫—Ä–µ–¥–∏—Ç:\n\nüí∞ –°—É–º–º–∞: –¥–æ 50,000,000 ‚Ç∏\n‚è∞ –°—Ä–æ–∫: –¥–æ 25 –ª–µ—Ç\nüìä –°—Ç–∞–≤–∫–∞: –æ—Ç 8,50% –≥–æ–¥–æ–≤—ã—Ö\nüè° –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å: –æ—Ç 20%\n\n‚úÖ –ù–∏–∑–∫–∞—è —Å—Ç–∞–≤–∫–∞\n‚úÖ –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π –ø–µ—Ä–∏–æ–¥\n‚úÖ –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞\n‚úÖ –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≤ –ø–æ–¥–∞—Ä–æ–∫\n\n–ò–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç –∏–ø–æ—Ç–µ–∫–∞?`,
        {
          reply_markup: {
            inline_keyboard: [
              [{ text: 'üìã –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É', url: `${WEBSITE_URL}/#application` }],
              [{ text: 'üßÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–ª–∞—Ç–µ–∂', url: `${WEBSITE_URL}/#credit-calculator` }]
            ]
          }
        }
      );
      break;
      
    case 'üöó –ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç':
      bot.sendMessage(chatId, 
        `üöó –ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç:\n\nüí∞ –°—É–º–º–∞: –¥–æ 15,000,000 ‚Ç∏\n‚è∞ –°—Ä–æ–∫: –¥–æ 7 –ª–µ—Ç\nüìä –°—Ç–∞–≤–∫–∞: –æ—Ç 9,90% –≥–æ–¥–æ–≤—ã—Ö\nüöô –ë–µ–∑ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –≤–∑–Ω–æ—Å–∞\n\n‚úÖ –ë—ã—Å—Ç—Ä–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ\n‚úÖ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –≤ –ø–æ–¥–∞—Ä–æ–∫\n‚úÖ –í—ã–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è\n‚úÖ –®–∏—Ä–æ–∫–∏–π –≤—ã–±–æ—Ä –∞–≤—Ç–æ\n\n–ì–æ—Ç–æ–≤—ã –∫—É–ø–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å?`,
        {
          reply_markup: {
            inline_keyboard: [
              [{ text: 'üìã –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É', url: `${WEBSITE_URL}/#application` }],
              [{ text: 'üßÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–ª–∞—Ç–µ–∂', url: `${WEBSITE_URL}/#credit-calculator` }]
            ]
          }
        }
      );
      break;
      
    case 'üíº –ë–∏–∑–Ω–µ—Å –∫—Ä–µ–¥–∏—Ç':
      bot.sendMessage(chatId, 
        `üíº –ö—Ä–µ–¥–∏—Ç –¥–ª—è –±–∏–∑–Ω–µ—Å–∞:\n\nüí∞ –°—É–º–º–∞: –¥–æ 100,000,000 ‚Ç∏\n‚è∞ –°—Ä–æ–∫: –¥–æ 5 –ª–µ—Ç\nüìä –°—Ç–∞–≤–∫–∞: –æ—Ç 12,50% –≥–æ–¥–æ–≤—ã—Ö\nüíº –õ—å–≥–æ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥: –¥–æ 6 –º–µ—Å—è—Ü–µ–≤\n\n‚úÖ –ë–µ–∑ –∑–∞–ª–æ–≥–∞\n‚úÖ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥\n‚úÖ –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ\n‚úÖ –ì–∏–±–∫–∏–µ —É—Å–ª–æ–≤–∏—è\n\n–†–∞–∑–≤–∏–≤–∞–π—Ç–µ –±–∏–∑–Ω–µ—Å —Å –Ω–∞–º–∏!`,
        {
          reply_markup: {
            inline_keyboard: [
              [{ text: 'üìã –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É', url: `${WEBSITE_URL}/#application` }],
              [{ text: 'üßÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–ª–∞—Ç–µ–∂', url: `${WEBSITE_URL}/#credit-calculator` }]
            ]
          }
        }
      );
      break;
      
    // –î–µ–ø–æ–∑–∏—Ç–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã
    case 'üìà –†–∞—Ö–º–µ—Ç –¥–µ–ø–æ–∑–∏—Ç':
      bot.sendMessage(chatId, 
        `üìà –†–∞—Ö–º–µ—Ç –¥–µ–ø–æ–∑–∏—Ç:\n\nüí∞ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: 100,000 ‚Ç∏\n‚è∞ –°—Ä–æ–∫: 3, 6, 12 –º–µ—Å—è—Ü–µ–≤\nüìä –°—Ç–∞–≤–∫–∞: –¥–æ 17,80% –≥–æ–¥–æ–≤—ã—Ö\nüíé –ü–æ–ø–æ–ª–Ω—è–µ–º—ã–π –¥–µ–ø–æ–∑–∏—Ç\n\n‚úÖ –í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç\n‚úÖ –ì–∏–±–∫–∏–µ —É—Å–ª–æ–≤–∏—è\n‚úÖ –ù–∞–¥–µ–∂–Ω–∞—è –∑–∞—â–∏—Ç–∞\n‚úÖ –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã\n\n–ù–∞—á–Ω–∏—Ç–µ –∫–æ–ø–∏—Ç—å —É–∂–µ —Å–µ–≥–æ–¥–Ω—è!`,
        {
          reply_markup: {
            inline_keyboard: [
              [{ text: 'üìã –û—Ç–∫—Ä—ã—Ç—å –¥–µ–ø–æ–∑–∏—Ç', url: `${WEBSITE_URL}/#application` }],
              [{ text: 'üßÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–æ—Ö–æ–¥', url: `${WEBSITE_URL}/#credit-calculator` }]
            ]
          }
        }
      );
      break;
      
    case 'üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é':
      userStates.set(userId, 'main');
      bot.sendMessage(chatId, 'üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:', mainMenu);
      break;
      
    default:
      // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—Å–∞–ª —á—Ç–æ-—Ç–æ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–µ
      if (userState === 'credits') {
        bot.sendMessage(chatId, '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∫—Ä–µ–¥–∏—Ç–∞ –∏–∑ –º–µ–Ω—é –Ω–∏–∂–µ:', creditMenu);
      } else if (userState === 'deposits') {
        bot.sendMessage(chatId, '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –¥–µ–ø–æ–∑–∏—Ç–∞ –∏–∑ –º–µ–Ω—é –Ω–∏–∂–µ:', depositMenu);
      } else {
        bot.sendMessage(chatId, 
          `ü§î –ù–µ –ø–æ–Ω–∏–º–∞—é –≤–∞—à –∑–∞–ø—Ä–æ—Å. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—é –Ω–∏–∂–µ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ /start –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞.`,
          mainMenu
        );
      }
      break;
  }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
bot.on('polling_error', (error) => {
  console.error('Polling error:', error);
});

bot.on('error', (error) => {
  console.error('Bot error:', error);
});

console.log('ü§ñ Telegram Bot –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!');
console.log('üì± –ë–æ—Ç: @ExpensiveFinanceBot');
console.log('üåê –°–∞–π—Ç:', WEBSITE_URL);

module.exports = bot;
